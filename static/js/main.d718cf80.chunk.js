(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{412:function(e,t,n){e.exports=n(990)},417:function(e,t,n){},458:function(e,t){},460:function(e,t){},525:function(e,t){},526:function(e,t){},617:function(e,t){},618:function(e,t){},718:function(e,t){},811:function(e,t){},813:function(e,t){},889:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=889},990:function(e,t,n){"use strict";n.r(t);var a=n(7),r=n.n(a),c=n(409),u=n.n(c),o=(n(417),n(68)),s=n(3),i=n.n(s),l=n(17),f=n(32),p=n(27),m=n(36),h=n(21),d=n(22),b=n(34),v=n.n(b);function g(){return x.apply(this,arguments)}function x(){return(x=Object(l.a)(i.a.mark(function e(){var t,n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.currentSession();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,Object(m.b)(t.webId);case 7:return n=e.sent,a=n.getSubject(t.webId),e.abrupt("return",a);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(){return y.apply(this,arguments)}function y(){return(y=Object(l.a)(i.a.mark(function e(){var t,n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:if((n=t.getRef(p.c.publicTypeIndex))&&"string"===typeof n){e.next=8;break}return e.abrupt("return",null);case 8:return e.next=10,Object(m.b)(n);case 10:return a=e.sent,e.abrupt("return",a);case 12:case"end":return e.stop()}},e)}))).apply(this,arguments)}var E=n(368),k=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"getRoot",value:function(){var e=Object(l.a)(i.a.mark(function e(){var t,n,a,r,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([g(),w()]);case 2:if(t=e.sent,n=Object(f.a)(t,2),a=n[0],r=n[1],null!==a&&null!==r){e.next=8;break}return e.abrupt("return",null);case 8:if("string"===typeof(c=a.getRef(p.d.storage))){e.next=11;break}return e.abrupt("return",null);case 11:return c&&void 0!==c&&(c="/"===c.substring(c.length-1,c.length)?c.slice(0,-1):c),e.abrupt("return",c);case 13:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"checkNotesFolder",value:function(){var e=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRoot();case 2:e.t0=e.sent,e.t1=this.shoutboxFolder,t=e.t0+e.t1,E.readFolder(t).then(null,E.createFolder(t));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"readFileAsString",value:function(){var t=Object(l.a)(i.a.mark(function t(n,a){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="",t.next=3,E.readFile(n).then(function(e){r=e},function(t){console.log("Error when reading file ".concat(n,", returning blank")),a&&e.createFile(n)});case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"createFile",value:function(){var e=Object(l.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:E.createFile(t).then(function(){return!0},function(e){return console.log("Error while creating file "+t)});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateFile",value:function(){var e=Object(l.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:E.updateFile(t,n).then(function(){return!0},function(e){return console.log("Error while updating file "+t)});case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"createFileWithContent",value:function(){var e=Object(l.a)(i.a.mark(function e(t,n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:E.createFile(t).then(E.updateFile(t,n).then(function(){return!0},function(e){return console.log("Error while updating file "+t)}),function(e){return console.log("Error while creating file "+t)});case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();k.shoutboxFolder="/public/shoutbox";var N=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"getShoutBoxMetas",value:function(){var e=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(this.couchDbBaseUrl,'/_design/DesignDoc/_view/MetasByTagsAndDates?startkey="appName:shoutbox"&endkey="appName:shoutboxZ"&descending=false&limit=25'),console.log(t),e.next=4,this.executeQueryonCouch(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryonCouch",value:function(e){var t=this;return new Promise(function(n,a){var r=t.CreateRequest("GET",e);r&&(r.onload=function(){if(r.status>=200&&r.status<300){var e=JSON.parse(r.response);n(e.rows)}else console.log(r.statusText),a(r.statusText)},r.onerror=function(){console.log(r.statusText),a(r.statusText)},r.send())})}},{key:"writeMeta",value:function(e){var t=this.CreateRequest("PUT","".concat(this.couchDbBaseUrl,"/").concat(this.createIdFromMeta(e)));t&&(t.onload=function(){},t.onerror=function(){alert("Error writing meta in CouchDb.")},t.send(JSON.stringify(e)))}},{key:"CreateRequest",value:function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?(n.open(e,t,!0),n.setRequestHeader("Content-Type","application/json")):alert("XMLHttpRequest not supported"),n}},{key:"createIdFromMeta",value:function(e){var t=new RegExp("[/]","g");return(e.hostName+e.pathName).replace(t,".")}}]),e}();N.couchDbServerUrl="http://91.186.9.6:5984",N.couchDbDatabaseName="solid",N.couchDbBaseUrl="".concat(N.couchDbServerUrl,"/").concat(N.couchDbDatabaseName);var O=n(368),j=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"getMetaIndexFilePath",value:function(){var t=Object(l.a)(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==this.metaIndexFilePath){t.next=5;break}return t.next=3,k.getRoot();case 3:n=t.sent,this.metaIndexFilePath="".concat(n).concat(e.tagDir,"/").concat(e.tagFileName);case 5:return t.abrupt("return",this.metaIndexFilePath);case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"createMeta",value:function(){var e=Object(l.a)(i.a.mark(function e(t){var n,a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new URL(t),a={hostName:n.hostname,pathName:n.pathname,mimeType:"ttl",creationDate:new Date,tags:[{tagType:"AppName",value:"shoutbox",published:!0}]},e.next=4,this.getAllLocalMetas();case 4:return(r=(r=e.sent).filter(function(e){return!(e.hostName===a.hostName&&e.pathName===a.pathName)})).push(a),e.t0=O,e.next=10,this.getMetaIndexFilePath();case 10:e.t1=e.sent,e.t2=JSON.stringify(r),e.t0.updateFile.call(e.t0,e.t1,e.t2),N.writeMeta(a);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAllLocalMetas",value:function(){var e=Object(l.a)(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.t0=k,e.next=4,this.getMetaIndexFilePath();case 4:return e.t1=e.sent,e.next=7,e.t0.readFileAsString.call(e.t0,e.t1,!0);case 7:return""!==(n=e.sent)&&(t=JSON.parse(n)),e.abrupt("return",t);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getCentralMetas",value:function(){var e=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N.getShoutBoxMetas();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}();function F(e,t){return D.apply(this,arguments)}function D(){return(D=Object(l.a)(i.a.mark(function e(t,n){var a,r,c,u,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k.checkNotesFolder(),e.next=3,k.getRoot();case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0="";case 6:return a=e.t0,r="/public/shoutbox/note".concat(Math.floor(Date.now()/1e3),".ttl"),c="".concat(a).concat(r),u=Object(m.a)(c),(o=u.addSubject()).addRef(p.a.type,p.b.TextDigitalDocument),o.addLiteral(p.b.text,t),o.addLiteral(p.b.dateCreated,new Date(Date.now())),e.next=16,u.save();case 16:return e.next=18,Object(m.b)(u.asRef());case 18:return s=e.sent,n.push(s),j.createMeta(c),e.abrupt("return",n);case 22:case"end":return e.stop()}},e)}))).apply(this,arguments)}function S(){var e=function(){var e=r.a.useState(),t=Object(f.a)(e,2),n=t[0],a=t[1];return r.a.useEffect(function(){w().then(function(e){null!==e&&a(e)})},[]),n}(),t=r.a.useState(),n=Object(f.a)(t,2),a=n[0],c=n[1];return r.a.useEffect(function(){e&&Object(l.a)(i.a.mark(function e(){var t,n,a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.getCentralMetas();case 2:t=e.sent,n=[],a=0;case 5:if(!(a<t.length)){e.next=20;break}return r=void 0,e.prev=7,e.next=10,Object(m.b)("https://"+t[a].value.hostName+t[a].value.pathName);case 10:r=e.sent,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),r=Object(m.a)("");case 16:n.push(r);case 17:a++,e.next=5;break;case 20:c(n);case 21:case"end":return e.stop()}},e,null,[[7,13]])}))()},[e]),a}j.tagDir="/public",j.tagFileName="_Meta.json",j.metaIndexFilePath=void 0;var C=n(411),R=n.n(C),M={padding:"0.5rem 1rem 0.5rem 1rem",backgroundColor:"lightgray"},T=function(e){var t=r.a.useState(!1),n=Object(f.a)(t,2),a=n[0],c=n[1],u=r.a.useState(!1),o=Object(f.a)(u,2),s=o[0],m=o[1],h=r.a.useState(e.note.getString(p.b.text)),d=Object(f.a)(h,2),b=d[0],v=d[1],g=r.a.useState(b||""),x=Object(f.a)(g,2),w=x[0],y=x[1],E=function(){var t=Object(l.a)(i.a.mark(function t(n){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),m(!0),t.next=4,e.onChange(w);case 4:(a=t.sent)&&(v(a.getLiteral(p.b.text)),c(!1)),m(!1);case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}();if(a){var k=s?"is-loading":"";return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{onSubmit:E,className:"content"},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("textarea",{onChange:function(e){e.preventDefault(),y(e.target.value)},name:"note",id:"note",className:"textarea",value:w,disabled:s}))),r.a.createElement("div",{className:"field is-grouped"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{type:"submit",className:"button is-primary ".concat(k),disabled:s},"Save")),r.a.createElement("div",{className:"control"},r.a.createElement("button",{onClick:function(e){c(!1)},className:"button is-text"},"Cancel")))))}return r.a.createElement(r.a.Fragment,null,r.a.createElement("article",{className:"card",role:"button",style:{cursor:"pointer"},onClick:function(){return c(!0)}},r.a.createElement("div",{className:" content",style:M},r.a.createElement(R.a,{source:b||""}))))},L={overflow:"auto",height:"59vh",padding:"0 20px 0 20px",marginTop:"0",paddingTop:"0"},I=function(){var e=S(),t=r.a.useState(""),n=Object(f.a)(t,2),a=n[0],c=n[1],u=r.a.useState(),o=Object(f.a)(u,2),s=o[0],h=o[1];if(!e)return null;function d(){return(d=Object(l.a)(i.a.mark(function t(n){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),e){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,F(a,e);case 5:r=t.sent,h(r),c("");case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}function b(){return(b=Object(l.a)(i.a.mark(function t(n,a){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s||e){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,Object(m.b)(a.asRef());case 5:return r=t.sent,(a=r.getSubject(a.asRef())).setLiteral(p.b.text,n),a.setLiteral(p.b.dateModified,new Date(Date.now())),t.next=11,r.save();case 11:return t.next=13,Object(m.b)(a.asRef());case 13:return r=t.sent,a=r.getSubject(a.asRef()),t.abrupt("return",a);case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}var v=function(e){var t=[];return e.forEach(function(e){t.push(e.getSubjectsOfType(p.b.TextDigitalDocument)[0])}),t}(s||e).map(function(e){return void 0!==e?r.a.createElement("div",{key:e.asRef()},e.asRef().split("/")[2],r.a.createElement(T,{note:e,onChange:function(t){return function(e,t){return b.apply(this,arguments)}(t,e)}})):r.a.createElement("span",null)});return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",null,r.a.createElement("div",{style:L,id:"notesContainer"},v),r.a.createElement("br",null),r.a.createElement("form",{onSubmit:function(e){return d.apply(this,arguments)}},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("textarea",{onChange:function(e){e.preventDefault(),c(e.target.value)},name:"note",id:"note",className:"textarea",value:a}))),r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{type:"submit",className:"button is-primary"},"Add note"))))),function(){var e=document.getElementById("notesContainer");e&&setTimeout(function(){e.scrollTop=e.scrollHeight},500)}())},P={padding:"0.5rem 1rem 0.5rem 1rem",maxWidth:"60%"},B={backgroundColor:"#fafafa",padding:"0 1.5rem 0"},U=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:P},r.a.createElement("h1",{style:{fontSize:"2rem"}},"shoutbox"),r.a.createElement(I,null),r.a.createElement("footer",{style:B},r.a.createElement("div",{className:"columns"},r.a.createElement("div",{className:"column has-text-right"},r.a.createElement(o.LogoutButton,{className:"button"}))))))},A=URLSearchParams&&document.location.search?new URLSearchParams(document.location.search).get("webid"):null,q=function(){var e=r.a.useState(A),t=Object(f.a)(e,2),n=t[0],a=t[1];if(A){return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),n&&v.a.login(n)}},r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{htmlFor:"webid",className:"label"},"Your WebID:"),r.a.createElement("input",{type:"url",name:"webid",id:"webid",className:"input is-large",value:n||"",onChange:function(e){e.preventDefault(),a(e.target.value)}}))),r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{type:"submit",className:"button is-primary is-large",value:"Connect"}))))}return r.a.createElement(r.a.Fragment,null,r.a.createElement(o.LoginButton,{popup:"popup.html",className:"button is-large is-primary"},"Connect"))},J=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(r.a.StrictMode,null,r.a.createElement(o.LoggedOut,null,r.a.createElement("section",{className:"section"},r.a.createElement("p",{className:"content"},"Please connect to your Pod to start taking notes."),r.a.createElement("p",{className:"content"},r.a.createElement(q,null)))),r.a.createElement(o.LoggedIn,null,r.a.createElement(U,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[412,1,2]]]);
//# sourceMappingURL=main.d718cf80.chunk.js.map